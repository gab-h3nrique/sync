
# services:

  # db:
  #   image: postgres:16-alpine
  #   container_name: sync-db
  #   restart: always
  #   environment:
  #     POSTGRES_USER: garren
  #     POSTGRES_PASSWORD: garren
  #     POSTGRES_DB: syncdb
  #   ports:
  #     - "5432:5432"
  #   volumes:
  #     - pgdata:/var/lib/postgresql/data

#   sync:
#     build: "./"
#     container_name: sync
#     restart: always
#     ports:
#       - "3000:3000"
#     depends_on:
#       - db
#     volumes:
#       # Permite que o container crie outros containers
#       - .:/src
      
#       - /var/run/docker.sock:/var/run/docker.sock
#     env_file:
#       - .env

# volumes:
#   pgdata:

# services:

#   # socket service
#   sync:
#     build: "./"
#     container_name: sync
#     restart: always
#     volumes:
#       - .:/src
#       - ./database.db:/database.db
#       - /var/run/docker.sock:/var/run/docker.sock
#     ports:
#      - "3000:3000"

services:
  sync_db:
    image: postgres:16-alpine
    hostname: sync_db
    container_name: sync_db
    restart: always
    environment:
      POSTGRES_DB: postgres
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: prisma
    ports:
      - '5432:5432'
    networks:
      - sync-network
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres -d postgres"]
      interval: 5s
      timeout: 2s
      retries: 20

  sync:
    build: "./"
    container_name: sync-app
    ports:
      - '3000:3000'  # porta da API
    stdin_open: true
    tty: true  # Keeps the container running for debugging
    depends_on:
      sync_db:
        condition: service_healthy
    env_file:
      - .env
    networks:
      - sync-network
    volumes:
      # - .:/src
      - /var/run/docker.sock:/var/run/docker.sock

networks:
  sync-network:
    name: sync-network
    